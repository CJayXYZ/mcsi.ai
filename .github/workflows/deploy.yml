name: Deploy to Raspberry Pi

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Deploy to Pi
        run: |
          echo "ğŸš€ Starting deployment..."
          cd /home/prime/github-deployment/mcsi.ai
          git pull origin main
          echo "âœ… Deployment complete at $(date)"
      
      - name: Restart PM2 service (if exists)
        run: |
          if pm2 list | grep -q "hello-server"; then
            echo "ğŸ”„ Restarting PM2 service..."
            pm2 restart hello-server
            echo "âœ… Service restarted on port 8080"
          else
            echo "â„¹ï¸  No PM2 service named 'hello-server' found. Skipping restart."
          fi
        continue-on-error: true
